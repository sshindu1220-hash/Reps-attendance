<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>REPS-ENTECH Attendance</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f2f2f2; text-align: center; }
#logo { width: 150px; margin-bottom: 20px; }
h1 { color: #2c3e50; margin-bottom: 30px; }
form { background: #fff; padding: 20px; border-radius: 10px; max-width: 600px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.2); text-align: left; }
label { display: block; margin-top: 15px; font-weight: bold; }
input, select, button { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
button { background: #27ae60; color: #fff; border: none; cursor: pointer; margin-top: 20px; transition: background 0.3s; }
button:hover { background: #2ecc71; }
#preview { margin-top: 15px; width: 100%; max-width: 100%; border-radius: 10px; display: block; }
#cameraButton { display: inline-block; background: #2980b9; color: #fff; padding: 10px 15px; border-radius: 50px; cursor: pointer; text-align: center; font-weight: bold; margin-top: 15px; transition: background 0.3s; }
#cameraButton:hover { background: #3498db; }

/* Thank You message overlay */
#thankYouOverlay {
  display: none;
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.7);
  color: #fff;
  font-size: 24px;
  text-align: center;
  padding-top: 200px;
  z-index: 9999;
}
</style>
</head>
<body>

<img id="logo" src="/mnt/data/reps...png" alt="REPS Logo">

<h3>REPS EN-TECH Pvt. Ltd. Attendance</h3>

<form id="attendanceForm">
<label for="state">Select State</label>
<select id="state" required>
<option value="">--Select State--</option>
<option>Andhra Pradesh</option>
<option>Arunachal Pradesh</option>
<option>Assam</option>
<option>Bihar</option>
<option>Chhattisgarh</option>
<option>Goa</option>
<option>Gujarat</option>
<option>Haryana</option>
<option>Himachal Pradesh</option>
<option>Jharkhand</option>
<option>Karnataka</option>
<option>Kerala</option>
<option>Madhya Pradesh</option>
<option>Maharashtra</option>
<option>Manipur</option>
<option>Meghalaya</option>
<option>Mizoram</option>
<option>Nagaland</option>
<option>Odisha</option>
<option>Punjab</option>
<option>Rajasthan</option>
<option>Sikkim</option>
<option>Tamil Nadu</option>
<option>Telangana</option>
<option>Tripura</option>
<option>Uttar Pradesh</option>
<option>Uttarakhand</option>
<option>West Bengal</option>
</select>

<label for="siteName">Select Site Name</label>
<select id="siteName" required>
<option value="">--Select Site--</option>
<option>Ambuja Site</option>
<option>Site 2</option>
<option>Site 3</option>
</select>

<label for="employeeName">Your Name</label>
<input type="text" id="employeeName" placeholder="Enter Your Name" required>

<label for="designation">Your Designation</label>
<input type="text" id="designation" placeholder="Enter Your Designation" required>

<label for="datetime">Date & Time</label>
<input type="text" id="datetime" readonly>

<div id="photoSection">
<div id="cameraButton">ðŸ“· Capture Photo</div>
<input type="file" id="photoInput" accept="image/*" capture="user" style="display:none;">
<img id="preview" src="" alt="Photo Preview">
</div>

<button type="submit">Submit Attendance</button>
</form>

<div id="thankYouOverlay">Thank You! Attendance Submitted Successfully.</div>

<script>
function updateDateTime() {
    const now = new Date();
    document.getElementById('datetime').value = now.toLocaleString();
}
updateDateTime();
setInterval(updateDateTime, 1000);

const photoInput = document.getElementById('photoInput');
const preview = document.getElementById('preview');
const cameraButton = document.getElementById('cameraButton');

cameraButton.addEventListener('click', () => photoInput.click());
photoInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = function(event){ preview.src = event.target.result; }
        reader.readAsDataURL(file);
    }
});

const form = document.getElementById('attendanceForm');
const overlay = document.getElementById('thankYouOverlay');

form.addEventListener('submit', async e => {
    e.preventDefault();
    const data = {
        state: document.getElementById('state').value,
        siteName: document.getElementById('siteName').value,
        employeeName: document.getElementById('employeeName').value,
        designation: document.getElementById('designation').value,
        datetime: document.getElementById('datetime').value,
        photo: preview.src
    };

    const webAppUrl = "YOUR_WEB_APP_URL"; // Replace with your Google Apps Script Web App URL

    try {
        await fetch(webAppUrl, {
            method: 'POST',
            body: JSON.stringify(data),
            headers: { 'Content-Type': 'application/json' }
        });

        // Show Thank You overlay
        overlay.style.display = 'block';
        setTimeout(() => {
            overlay.style.display = 'none';
            form.reset();
            preview.src = '';
            updateDateTime();
        }, 3000);

    } catch (error) {
        console.error(error);
        alert("Error submitting attendance. Check console.");
    }
});
// ------------- CONFIGURATION -------------
const SHEET_NAME = "Sheet1"; // Your Google Sheet name
const EMAIL_TO = "surajsahani0490@gmail.com"; // Your email to receive monthly report
// -----------------------------------------

// Save attendance submitted from HTML form
function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_NAME);
    sheet.appendRow([
      data.state, 
      data.siteName, 
      data.employeeName, 
      data.designation, 
      data.datetime, 
      data.photo
    ]);
    return ContentService.createTextOutput(JSON.stringify({ result: 'success' }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({ result: 'error', message: error }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Send monthly attendance report as CSV/Excel via email
function sendMonthlyAttendance() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_NAME);
  const lastRow = sheet.getLastRow();
  if (lastRow < 2) return; // No data

  // Get all data
  const dataRange = sheet.getRange(2, 1, lastRow - 1, sheet.getLastColumn());
  const data = dataRange.getValues();

  // Convert to CSV
  let csv = "";
  const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
  csv += headers.join(",") + "\n";

  data.forEach(row => {
    csv += row.map(item => `"${item}"`).join(",") + "\n";
  });

  // Send email with CSV attachment
  MailApp.sendEmail({
    to: EMAIL_TO,
    subject: "Monthly Attendance Report",
    body: "Please find attached the attendance sheet for this month.",
    attachments: [
      { fileName: "Attendance_Report.csv", content: csv, mimeType: "text/csv" }
    ]
  });
}

</script>

</body>
</html>
